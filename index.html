<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAN1cDb1yBdYBzEXQ2CD8anlih7YuPXggo",
    authDomain: "mitas-estimate.firebaseapp.com",
    projectId: "mitas-estimate",
    storageBucket: "mitas-estimate.appspot.com",
    messagingSenderId: "889863551826",
    appId: "1:889863551826:web:71577461b5b9d810d4188b",
    measurementId: "G-Y0H10QQQ16"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  document.getElementById("estimateForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const structure = document.getElementById("structure").value;
    const area = document.getElementById("area").value;
    const address = document.getElementById("address").value;
    const scaffoldArea = document.getElementById("scaffoldArea").value;
    const leftovers = document.querySelector('input[name="leftovers"]:checked')?.value || "";
    const additional = document.querySelector('input[name="additional"]:checked')?.value || "";

    const data = {
      structure,
      area,
      address,
      scaffoldArea,
      hasLeftovers: leftovers,
      hasAdditionalWork: additional,
      createdAt: new Date()
    };

    // Firestoreに保存
    db.collection("estimates").add(data)
      .then(() => {
        // 保存成功後に uchiwake.html に遷移
        const params = new URLSearchParams({
          structure,
          area,
          address,
          scaffold: scaffoldArea,
          leftovers,
          additional
        });
        window.location.href = `uchiwake.html?${params.toString()}`;
      })
      .catch((error) => {
        alert("保存エラー: " + error);
      });
  });
</script>