<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MiTAS 編集画面</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    label { display: block; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>見積内容の編集</h1>
  <form id="editForm">
    <label>建物構造：<input type="text" id="structure" /></label>
    <label>延床面積（㎡）：<input type="number" id="area" /></label>
    <label>現場住所：<input type="text" id="address" /></label>
    <label>足場面積（㎡）：<input type="number" id="scaffoldArea" /></label>
    <label>残置物の有無：<input type="text" id="leftovers" /></label>
    <label>付帯工事の有無：<input type="text" id="additional" /></label>
    <button type="submit">内訳を確認</button>
  </form>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAN1cDb1yBdYBzEXQ2CD8anlih7YuPXggo",
      authDomain: "mitas-estimate.firebaseapp.com",
      projectId: "mitas-estimate",
      storageBucket: "mitas-estimate.appspot.com",
      messagingSenderId: "889863551826",
      appId: "1:889863551826:web:71577461b5b9d810d4188b",
      measurementId: "G-Y0H10QQQ16"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // URLからdocIdを取得（例: edit.html?id=abc123）
    const params = new URLSearchParams(window.location.search);
    const docId = params.get("id");

    const form = document.getElementById("editForm");

    // 編集対象の見積データを取得して表示
    if (docId) {
      db.collection("estimates").doc(docId).get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          document.getElementById("structure").value = data.structure || "";
          document.getElementById("area").value = data.area || "";
          document.getElementById("address").value = data.address || "";
          document.getElementById("scaffoldArea").value = data.scaffoldArea || "";
          document.getElementById("leftovers").value = data.hasLeftovers || "";
          document.getElementById("additional").value = data.hasAdditionalWork || "";
        }
      });
    }

    // 編集して「見積内訳ページへ遷移」
    form.addEventListener("submit", function(e) {
      e.preventDefault();

      const structure = document.getElementById("structure").value;
      const area = document.getElementById("area").value;
      const address = document.getElementById("address").value;
      const scaffoldArea = document.getElementById("scaffoldArea").value;
      const leftovers = document.getElementById("leftovers").value;
      const additional = document.getElementById("additional").value;

      const query = new URLSearchParams({
        structure,
        area,
        address,
        scaffold: scaffoldArea,
        leftovers,
        additional
      });

      window.location.href = `uchiwake.html?${query.toString()}`;
    });
  </script>
</body>
</html>