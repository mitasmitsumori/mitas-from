<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MiTAS 見積内訳</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; line-height: 1.6; }
    h1 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #999; padding: 8px; text-align: left; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 16px; }
  </style>
</head>
<body>
  <h1>見積内訳書</h1>
  <div id="estimateContent">
    <table>
      <tbody id="estimateTable">
        <!-- 表示内容はJavaScriptで反映 -->
      </tbody>
    </table>
  </div>

  <button onclick="downloadPDF()">PDF出力</button>

  <script>
    const params = new URLSearchParams(window.location.search);

    const data = {
      '建物構造': params.get('structure'),
      '延床面積（㎡）': params.get('area'),
      '現場住所': params.get('address'),
      '足場面積（㎡）': params.get('scaffold'),
      '残置物の有無': params.get('leftovers'),
      '付帯工事の有無': params.get('additional'),
      '木くず（kg）': params.get('woodWaste'),
      'ボード類（kg）': params.get('boardWaste'),
      '廃プラ類（kg）': params.get('plasticWaste'),
      'ガラ（kg）': params.get('rubbleWaste'),
      'ガラス（kg）': params.get('glassWaste'),
      '陶器（kg）': params.get('ceramicWaste')
    };

    const table = document.getElementById('estimateTable');

    for (const key in data) {
      const row = document.createElement('tr');
      const labelCell = document.createElement('th');
      labelCell.textContent = key;
      const valueCell = document.createElement('td');
      valueCell.textContent = data[key] || '—';
      row.appendChild(labelCell);
      row.appendChild(valueCell);
      table.appendChild(row);
    }

    function downloadPDF() {
      const element = document.body;
      const opt = {
        margin: 0.5,
        filename: 'mitas-estimate.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }
  </script>
</body>
</html>