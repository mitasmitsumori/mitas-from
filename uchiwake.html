<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>御見積内訳書</title>
  <style>
    body {
      font-family: "IPAex明朝", serif;
      padding: 20px;
    }
    h1 {
      text-align: center;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #eee;
    }
    .total {
      font-weight: bold;
      text-align: right;
    }
  </style>
</head>
<body>
  <h1>御見積内訳書</h1>
  <table>
    <thead>
      <tr><th>項目</th><th>数量</th><th>単価</th><th>金額</th></tr>
    </thead>
    <tbody id="estimateBody"></tbody>
    <tfoot>
      <tr>
        <td colspan="3" class="total">合計金額</td>
        <td id="totalPrice" class="total"></td>
      </tr>
    </tfoot>
  </table>

  <script>
    const params = new URLSearchParams(location.search);

    const structure = params.get("structure");
    const area = parseFloat(params.get("area")) || 0;
    const scaffoldArea = parseFloat(params.get("scaffold")) || 0;
    const woodWaste = parseFloat(params.get("woodWaste")) || 0;
    const boardWaste = parseFloat(params.get("boardWaste")) || 0;
    const plasticWaste = parseFloat(params.get("plasticWaste")) || 0;
    const rubbleWaste = parseFloat(params.get("rubbleWaste")) || 0;
    const glassWaste = parseFloat(params.get("glassWaste")) || 0;
    const ceramicWaste = parseFloat(params.get("ceramicWaste")) || 0;

    const unitPrices = {
      解体費: {
        木造: 33000, RC造: 50000, S造: 33000, 軽量鉄骨造: 33000
      },
      足場: 600,
      アスベスト調査費: 90000,
      重機回送費: 14000, // 仮で10km以内とする
      木くず: 16,
      ボード類: 35,
      廃プラ類: 50,
      ガラ: 2,
      ガラス: 10,
      陶器: 20
    };

    const items = [];

    // 解体費
    const tsubo = area * 0.3025;
    const dismantleCost = tsubo * unitPrices["解体費"][structure];
    items.push(["解体工事費", `${tsubo.toFixed(2)}坪`, `${unitPrices["解体費"][structure].toLocaleString()}円`, `${Math.round(dismantleCost).toLocaleString()}円`]);

    // 足場
    const scaffoldCost = scaffoldArea * unitPrices["足場"];
    items.push(["足場工事費", `${scaffoldArea}㎡`, `${unitPrices["足場"].toLocaleString()}円`, `${Math.round(scaffoldCost).toLocaleString()}円`]);

    // 重機回送
    items.push(["重機回送費", "-", "-", `${unitPrices["重機回送費"].toLocaleString()}円`]);

    // アスベスト調査
    items.push(["アスベスト調査費", "-", "-", `${unitPrices["アスベスト調査費"].toLocaleString()}円`]);

    // 産廃処分費
    const wastes = [
      ["木くず", woodWaste, unitPrices["木くず"]],
      ["ボード類", boardWaste, unitPrices["ボード類"]],
      ["廃プラ類", plasticWaste, unitPrices["廃プラ類"]],
      ["ガラ", rubbleWaste, unitPrices["ガラ"]],
      ["ガラス", glassWaste, unitPrices["ガラス"]],
      ["陶器", ceramicWaste, unitPrices["陶器"]]
    ];
    wastes.forEach(([label, qty, unit]) => {
      const cost = qty * unit;
      items.push([`${label}処分費`, `${qty}kg`, `${unit}円`, `${Math.round(cost).toLocaleString()}円`]);
    });

    // 表に反映
    const tbody = document.getElementById("estimateBody");
    let total = 0;
    items.forEach(([item, qty, price, cost]) => {
      const costValue = parseInt(cost.replace(/,/g, ""));
      total += costValue;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${item}</td><td>${qty}</td><td>${price}</td><td>${cost}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById("totalPrice").textContent = `${total.toLocaleString()}円`;
  </script>
</body>
</html>